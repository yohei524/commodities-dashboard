{% extends "base.html" %}

{% block title %}ãƒˆãƒ¬ãƒ¼ãƒ‰æ—¥èªŒ | Gold Experience{% endblock %}

{% block content %}
<div style="display: flex; flex-direction: column; gap: 32px;">

    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <div class="glass-card gold-border" style="padding: 32px;">
        <h1 style="font-size: 2rem; font-weight: 900; margin-bottom: 8px;">
            <span>ğŸ“’</span> ãƒˆãƒ¬ãƒ¼ãƒ‰æ—¥èªŒ
        </h1>
        <p style="color: var(--text-secondary);">
            ã‚¨ãƒ³ãƒˆãƒªãƒ¼/ã‚¨ã‚°ã‚¸ãƒƒãƒˆè¨˜éŒ²ã¨æç›Šç®¡ç†
        </p>
    </div>

    <!-- çµ±è¨ˆã‚µãƒãƒªãƒ¼ -->
    {% if data.stats %}
    <div class="grid grid-4">
        <div class="glass-card" style="padding: 20px; text-align: center;">
            <p style="color: var(--text-muted); font-size: 0.875rem;">ç´¯è¨ˆæç›Š</p>
            <p style="font-size: 2rem; font-weight: 900; color: {{ 'var(--success)' if data.stats.total_pnl > 0 else 'var(--danger)' }};">
                {% if data.stats.total_pnl > 0 %}+{% endif %}Â¥{{ "{:,}".format(data.stats.total_pnl) }}
            </p>
        </div>
        <div class="glass-card" style="padding: 20px; text-align: center;">
            <p style="color: var(--text-muted); font-size: 0.875rem;">å‹ç‡</p>
            <p style="font-size: 2rem; font-weight: 900; color: var(--gold);">{{ data.stats.win_rate }}%</p>
            <p style="font-size: 0.8rem; color: var(--text-muted);">{{ data.stats.win_trades }}å‹ {{ data.stats.lose_trades }}æ•—</p>
        </div>
        <div class="glass-card" style="padding: 20px; text-align: center;">
            <p style="color: var(--text-muted); font-size: 0.875rem;">å¹³å‡åˆ©ç›Š / æå¤±</p>
            <p style="font-size: 1.25rem; font-weight: 700;">
                <span style="color: var(--success);">+Â¥{{ "{:,}".format(data.stats.avg_win) }}</span>
                /
                <span style="color: var(--danger);">Â¥{{ "{:,}".format(data.stats.avg_lose) }}</span>
            </p>
        </div>
        <div class="glass-card" style="padding: 20px; text-align: center;">
            <p style="color: var(--text-muted); font-size: 0.875rem;">ãƒ—ãƒ­ãƒ•ã‚£ãƒƒãƒˆãƒ•ã‚¡ã‚¯ã‚¿ãƒ¼</p>
            <p style="font-size: 2rem; font-weight: 900; color: {{ 'var(--success)' if data.stats.profit_factor > 1 else 'var(--danger)' }};">
                {{ data.stats.profit_factor }}
            </p>
        </div>
    </div>
    {% endif %}

    <!-- ãƒˆãƒ¬ãƒ¼ãƒ‰ä¸€è¦§ -->
    <div class="glass-card" style="padding: 24px;">
        <h2 class="section-title">
            <span class="icon">ğŸ“Š</span>
            ãƒˆãƒ¬ãƒ¼ãƒ‰å±¥æ­´
        </h2>
        <table class="data-table">
            <thead>
                <tr>
                    <th>æ—¥ä»˜</th>
                    <th>éŠ˜æŸ„</th>
                    <th>æ–¹å‘</th>
                    <th>ã‚¨ãƒ³ãƒˆãƒªãƒ¼</th>
                    <th>ã‚¨ã‚°ã‚¸ãƒƒãƒˆ</th>
                    <th>æ•°é‡</th>
                    <th>æç›Š</th>
                    <th>æ ¹æ‹ </th>
                </tr>
            </thead>
            <tbody>
                {% for trade in data.trades | default([
                    {
                        'date': '2026-01-28',
                        'symbol': 'GOLD',
                        'direction': 'long',
                        'entry': 2780,
                        'exit': 2805,
                        'size': '1oz',
                        'pnl': 3750,
                        'reason': 'ä¸­æ±ç·Šå¼µæ¿€åŒ–ã€RSIéç†±ãªã—ã€MAä¸Šå‘ã',
                        'result_note': 'äºˆæƒ³é€šã‚Šä¸Šæ˜‡ã€‚åˆ©ç¢ºãƒ©ã‚¤ãƒ³2800åˆ°é”ã§æ±ºæ¸ˆ'
                    },
                    {
                        'date': '2026-01-25',
                        'symbol': 'SILVER',
                        'direction': 'long',
                        'entry': 30.50,
                        'exit': 31.20,
                        'size': '100oz',
                        'pnl': 10500,
                        'reason': 'é‡‘éŠ€ãƒ¬ã‚·ã‚ª90è¶…ãˆâ†’éŠ€å‰²å®‰ã€ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«ã‚‚ä¸Šå‘ã',
                        'result_note': 'é‡‘ã«è¿½éšã—ã¦ä¸Šæ˜‡'
                    },
                    {
                        'date': '2026-01-22',
                        'symbol': 'WTI',
                        'direction': 'short',
                        'entry': 79.50,
                        'exit': 80.20,
                        'size': '10ãƒãƒ¬ãƒ«',
                        'pnl': -10500,
                        'reason': 'OPECæ¸›ç”£ãªã—ã§ä¸‹è½äºˆæƒ³',
                        'result_note': 'ä¸­æ±ãƒªã‚¹ã‚¯ã§é€†è¡Œã€‚æåˆ‡ã‚Š'
                    }
                ]) %}
                <tr>
                    <td>{{ trade.date }}</td>
                    <td>
                        <span class="tag {% if trade.symbol == 'GOLD' %}tag-gold{% elif trade.symbol == 'SILVER' %}tag-silver{% else %}tag-oil{% endif %}">
                            {{ trade.symbol }}
                        </span>
                    </td>
                    <td>
                        {% if trade.direction == 'long' %}
                        <span style="color: var(--success); font-weight: 700;">ğŸ“ˆ LONG</span>
                        {% else %}
                        <span style="color: var(--danger); font-weight: 700;">ğŸ“‰ SHORT</span>
                        {% endif %}
                    </td>
                    <td style="font-weight: 600;">{{ trade.entry }}</td>
                    <td style="font-weight: 600;">{{ trade.exit }}</td>
                    <td>{{ trade.size }}</td>
                    <td style="font-weight: 700; color: {{ 'var(--success)' if trade.pnl > 0 else 'var(--danger)' }};">
                        {% if trade.pnl > 0 %}+{% endif %}Â¥{{ "{:,}".format(trade.pnl) }}
                    </td>
                    <td style="font-size: 0.8rem; color: var(--text-secondary); max-width: 200px;">
                        {{ trade.reason }}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- ãƒˆãƒ¬ãƒ¼ãƒ‰è©³ç´°ï¼ˆæœ€æ–°ï¼‰ -->
    {% set latest = data.trades[0] if data.trades else none %}
    {% if latest %}
    <div class="glass-card" style="padding: 24px;">
        <h2 class="section-title">
            <span class="icon">ğŸ”</span>
            æœ€æ–°ãƒˆãƒ¬ãƒ¼ãƒ‰è©³ç´°
        </h2>
        <div class="grid grid-2">
            <div style="padding: 20px; background: rgba(212, 175, 55, 0.1); border-radius: 12px;">
                <h3 style="font-weight: 700; color: var(--gold); margin-bottom: 12px;">ã‚¨ãƒ³ãƒˆãƒªãƒ¼æ ¹æ‹ </h3>
                <p style="color: var(--text-secondary); line-height: 1.7;">{{ latest.reason }}</p>
            </div>
            <div style="padding: 20px; background: rgba(192, 192, 192, 0.1); border-radius: 12px;">
                <h3 style="font-weight: 700; color: var(--silver); margin-bottom: 12px;">çµæœãƒ»åçœ</h3>
                <p style="color: var(--text-secondary); line-height: 1.7;">{{ latest.result_note | default('è¨˜éŒ²ãªã—') }}</p>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- ãƒ«ãƒ¼ãƒ«ç¢ºèª -->
    <div class="glass-card" style="padding: 24px; border: 2px solid var(--gold);">
        <h2 class="section-title">
            <span class="icon">ğŸ“‹</span>
            ãƒã‚¤ãƒˆãƒ¬ãƒ¼ãƒ‰ãƒ«ãƒ¼ãƒ«
        </h2>
        <div class="grid grid-2">
            <div style="padding: 20px;">
                <h3 style="font-weight: 700; color: var(--success); margin-bottom: 12px;">ã‚¨ãƒ³ãƒˆãƒªãƒ¼æ¡ä»¶</h3>
                <ul style="color: var(--text-secondary); font-size: 0.9rem; line-height: 2; padding-left: 20px;">
                    {% for rule in data.rules.entry | default([
                        'åœ°æ”¿å­¦ãƒªã‚¹ã‚¯ä¸Šæ˜‡ + ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«ä¸Šå‘ã',
                        'RSI 70æœªæº€ï¼ˆéç†±ãªã—ï¼‰',
                        'æ—¥è¶³MA(20)ã®ä¸Šã«ã‚ã‚‹',
                        'ã‚µãƒãƒ¼ãƒˆãƒ©ã‚¤ãƒ³ä»˜è¿‘ã§ã®æŠ¼ã—ç›®',
                        'æåˆ‡ã‚Šãƒ©ã‚¤ãƒ³ã‚’å…ˆã«æ±ºã‚ã‚‹'
                    ]) %}
                    <li>{{ rule }}</li>
                    {% endfor %}
                </ul>
            </div>
            <div style="padding: 20px;">
                <h3 style="font-weight: 700; color: var(--danger); margin-bottom: 12px;">ãƒªã‚¹ã‚¯ç®¡ç†</h3>
                <ul style="color: var(--text-secondary); font-size: 0.9rem; line-height: 2; padding-left: 20px;">
                    {% for rule in data.rules.risk | default([
                        '1ãƒˆãƒ¬ãƒ¼ãƒ‰ã®ãƒªã‚¹ã‚¯ã¯è³‡é‡‘ã®2%ä»¥å†…',
                        'æåˆ‡ã‚Šã¯å¿…ãšè¨­å®šï¼ˆ-3%ç›®å®‰ï¼‰',
                        'åˆ©ç¢ºã¯æåˆ‡ã‚Šå¹…ã®2å€ä»¥ä¸Š',
                        'åŒæ™‚ãƒã‚¸ã‚·ãƒ§ãƒ³ã¯3ã¤ã¾ã§',
                        'é€£æ•—3å›ã§1æ—¥ä¼‘ã‚€'
                    ]) %}
                    <li>{{ rule }}</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>

</div>
{% endblock %}
